# Инструкция по развертыванию на сервере

## Проблема: "Директория current не существует"

После клонирования репозитория на сервере директория `current/` может отсутствовать, так как она исключена из git.

## Решение

### Вариант 1: Автоматическое развертывание (рекомендуется)

```bash
# После клонирования репозитория
cd law_rag

# Запустите скрипт развертывания
python3 scripts/deploy_documents.py
```

Скрипт автоматически:
- Создаст директорию `current/` если её нет
- Скопирует документы из `current/examples/` в `current/`
- Покажет статистику

### Вариант 2: Ручное развертывание

```bash
# Создайте директорию
mkdir -p current

# Скопируйте документы из examples
cp current/examples/*.txt current/

# Проверьте количество
ls -1 current/*.txt | wc -l
```

### Вариант 3: Через админ-панель

Система автоматически попытается:
1. Создать директорию `current/` если её нет
2. Найти документы в `current/examples/`
3. Скопировать первые 10 документов для начала

## После развертывания документов

1. **Загрузите документы в базу данных:**
   - Перейдите в `/admin`
   - Система автоматически загрузит документы при первом обращении

2. **Обработайте документы (создание embeddings):**
   - В админ-панели нажмите "Обработать все документы"
   - Дождитесь завершения обработки

3. **Проверьте статус:**
   - В админ-панели должна быть статистика:
     - Документов: ~90-100
     - Чанков: несколько тысяч
     - Embeddings: должно совпадать с количеством чанков

## Проверка

```bash
# Проверьте наличие документов
ls -la current/*.txt | wc -l

# Проверьте размер
du -sh current/

# Должно быть ~90 файлов и ~4-5 MB
```

## Если документы не найдены

1. Убедитесь, что `current/examples/` содержит файлы `.txt`
2. Проверьте права доступа к директориям
3. Запустите скрипт развертывания вручную

## Ошибка "'total'"

Эта ошибка исправлена - теперь система безопасно обрабатывает случаи, когда результат обработки не содержит ключ 'total'.

